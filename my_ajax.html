<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>my ajax</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>


    <button onclick="getDataFromJSONFile()">get DATA</button>
    NAME : <input type="text" id="student_name" />
    AGE : <input type="number" id="student_age" />
    POSITION : <input type="text" id="student_position" />
    <button onclick="createDataToJSONFile()">create DATA</button>
    ID : <input type="text" id="student_id" />
    <button onclick="updateDataToJSONFile()">update DATA</button>
    <button onclick="deleteDataFromJSONFile()">delete DATA</button>

    <div id="div_students">
    </div>

    <script>

    function getDataFromJSONFile(){
        const xhr = new XMLHttpRequest(); 
        xhr.open("GET", "https://672818aa270bd0b975544f3a.mockapi.io/api/v1/players"); 
        xhr.setRequestHeader("content-type", "application/json");
        xhr.send();
        xhr.onload = () => { 
            //alert(JSON.stringify(xhr));
            if(xhr.status === 200){
                $("#div_students").html("");
                //alert(JSON.stringify(xhr.response));
                let students = JSON.parse(xhr.response);
                //alert(students.length);
                students.forEach((item) => {
                    $("#div_students").append("<div>ID: " + item.id + " | Name: " + item.name + " | Age: " + item.age + " | Position: " + item.position + "</div>");
                });
            }
        } 
    }

    function createDataToJSONFile(){
        const xhr = new XMLHttpRequest(); 
        xhr.open("POST", "https://672818aa270bd0b975544f3a.mockapi.io/api/v1/players"); 
        xhr.setRequestHeader("content-type", "application/json;chatset=UTF-8");

        let data = {name:$("#student_name").val(), age:$("#student_age").val(), position:$("#student_position").val()};

        xhr.send(JSON.stringify(data));
        xhr.onload = () => { 
            if(xhr.status === 201){
                alert("등록 성공!");
                getDataFromJSONFile();
            }
            //document.getElementById("demo").innerHTML = this.responseText; 
        } 
    }

    function updateData(id) {             
        const xhr = new XMLHttpRequest(); 
        xhr.open("PUT", "https://672818aa270bd0b975544f3a.mockapi.io/api/v1/players" + id); 
        xhr.setRequestHeader("content-type", "application/json; charset=UTF-8"); 

        let data = { name: $("#student_name").val(), age: $("#student_age").val(), position:$("#student_position").val()}; 

        xhr.send(JSON.stringify(data));
        xhr.onload = () => { 
            alert(xhr.status);
            if(xhr.status === 200){
                alert("수정 성공!");
                getDataFromJSONFile();
            }
        }
    }

    function updateDataToJSONFile() {
        const studentId = $("#student_id").val(); // 학생 ID 입력 필드에서 값 가져오기
        if (studentId) {
            updateData(studentId); // 입력된 ID를 사용하여 updateData 함수 호출
        } else {
            alert("학생 ID를 입력하세요.");
        }
    }

    function deleteDataFromJSONFile() {
        const studentId = $("#student_id").val(); // 삭제할 학생의 ID를 입력 필드에서 가져오기
        
        if (studentId) {
            const xhr = new XMLHttpRequest();
            xhr.open("DELETE", "https://672818aa270bd0b975544f3a.mockapi.io/api/v1/players" + studentId); // DELETE 요청으로 해당 ID의 데이터 삭제
            xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
            xhr.send();
            
            xhr.onload = () => {
                if (xhr.status === 200) {
                    alert("삭제 성공!");
                    getDataFromJSONFile(); // 삭제 후 목록 갱신
                } else {
                    alert("삭제 실패: 해당 ID의 학생이 없습니다.");
                }
            };
        } else {
            alert("삭제할 학생 ID를 입력하세요.");
        }
    }


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>
